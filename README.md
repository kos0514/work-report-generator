# 作業報告書管理システム

## 前提
- Windowsの際は、Excelで作業報告書の時間を入力できていたのですが、Macに買い替えてからは、毎日入力する手段がなくなりました。
- いちいちWindowsPCを起動して入力するのはとても辛いため、MacでCSVを流し込むことで、作業報告書の入力を実現。
- それでも月1日は、windowsPCを起動して最終確認が必要な気がしますが、まあ良いとします。
- なにかいい方法があれば、あっぷでーとしていきたいです。

### 補足
- 仕様書を下記に配置し、基本的にJetBrainsのJunieでVibeコーディングしました。
  - docs/SPECIFICATION.md

## 概要
作業報告書管理システムは、Spring Boot + Spring Shellを使用したCLIベースのアプリケーションです。このシステムを使用することで、作業報告書の作成と更新を簡単に行うことができます。

## 機能
- 新規作業報告書ファイルの作成（Excelファイルと対応するCSVファイルを自動生成）
- CSVファイルからの作業報告書の更新
- 祝日対応（内閣府提供の祝日データ使用）

## 動作環境
- Java 21
- Spring Boot 3.x
- Gradle

## インストール方法

### 前提条件
- Java 21がインストールされていること
- Gradleがインストールされていること（または付属のGradleラッパーを使用）

### セットアップ手順
1. リポジトリをクローンまたはダウンロードします
2. `local-data/templates/` ディレクトリに作業報告書のテンプレートファイル（`作業報告書 I社フォーマット.xls`）を配置します

## 使用方法

### アプリケーションの起動
```bash
./gradlew bootRun
```
起動後、以下のようなCLIプロンプトが表示されます：
```
shell:>
```

### 基本コマンド

#### 新規報告書ファイルの作成
```bash
shell:> create-file --month 2025/06 --user "田中太郎" --client "株式会社サンプル"
```
**パラメータ**:
- `--month`: 対象月（YYYY/MM形式）
- `--user`: ユーザー名
- `--client`: クライアント名

**処理内容**:
- テンプレートファイルをコピー
- Excelファイル名: `田中太郎_202506_作業報告書.xls`
- CSVファイル名: `202506_work_data.csv`
- 基本情報（対象月、クライアント、ユーザー名）を設定
- 平日（土日祝日以外）の日付に対してデフォルトの開始時刻、終了時刻、休憩時間を設定
- 同時に、平日の日付、デフォルト時間を含むCSVファイルを自動生成
- 生成されたExcelファイルは `local-data/output/` ディレクトリに保存されます
- 生成されたCSVファイルは `local-data/csv/` ディレクトリに保存されます

#### CSVファイルからの報告書更新
```bash
shell:> update-file --file "田中太郎_202506_作業報告書.xls" --csv "work_data.csv"
```
**パラメータ**:
- `--file`: 更新対象のExcelファイル名
- `--csv`: 入力CSVファイル名（`local-data/csv/` ディレクトリ内）

**処理内容**:
- 指定されたExcelファイルをCSVデータで更新
- 日付をキーとして該当行を特定・更新（開始時刻、終了時刻、休憩時間、作業内容）
- CSVファイルに含まれない日付の行は自動的にクリアされます
- 更新後、時間計算式が自動的に実行され、合計時間などが再計算されます

#### ヘルプ表示
```bash
shell:> help
```
コマンド一覧とヘルプ情報を表示します。

### CSVファイルの形式
CSVファイルは以下の形式で作成してください：
```csv
日付,開始時刻,終了時刻,休憩時間,作業内容
2025/06/02,09:30,17:45,1:00,システム設計書作成
2025/06/03,10:00,18:30,1:00,プログラム実装
2025/06/04,09:00,17:00,1:00,テスト実行
```

CSVファイルは `local-data/csv/` ディレクトリに配置してください。サンプルファイル `sample_work_data.csv` を参考にしてください。

## ディレクトリ構成
- `local-data/templates/` - Excelテンプレートファイル
  - `作業報告書 I社フォーマット.xls` を配置
- `local-data/output/` - 生成された作業報告書ファイル
- `local-data/csv/` - CSV入力ファイル

## 設定
設定は `application.yml` ファイルで行います：
```yaml
work-report:
  template-file: ./local-data/templates/作業報告書 I社フォーマット.xls
  output-dir: ./local-data/output
  csv-dir: ./local-data/csv
  holidays-file: classpath:config/syukujitsu.csv
```

## 使用例

### 月次報告書作成フロー
1. アプリケーションを起動
   ```bash
   ./gradlew bootRun
   ```

2. 新規ファイルを作成
   ```bash
   shell:> create-file --month 2025/06 --user "田中太郎" --client "株式会社サンプル"
   ```
   出力: 
   ```
   ファイル作成完了:
   - Excel: 田中太郎_202506_作業報告書.xls
   - CSV: 202506_work_data.csv
   ```

3. 自動生成されたCSVファイルを編集（外部エディタで）
   - 自動生成されたCSVファイル `202506_work_data.csv` には平日の日付とデフォルト時間が既に設定されています
   - 必要に応じて時間や作業内容を編集してください
   - フォーマット: 日付,開始時刻,終了時刻,休憩時間,作業内容
   - ファイルは既に `local-data/csv/` ディレクトリに保存されています

4. CSVデータで報告書を更新
   ```bash
   shell:> update-file --file "田中太郎_202506_作業報告書.xls" --csv "202506_work_data.csv"
   ```
   出力: `更新完了: 15 件`

5. 完了！ファイルは `local-data/output/` に保存されています

## エラーハンドリング
- **テンプレートファイルなし**: テンプレートファイルが見つからない場合、エラーメッセージが表示されます
- **CSV形式エラー**: CSVの形式が正しくない場合、行番号付きのエラーが表示されます
- **日付不一致**: CSVに含まれる日付が対象月に存在しない場合、その行はスキップされます
- **ファイル権限エラー**: ファイルの読み書き権限がない場合、権限問題の解決方法が提示されます
